pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	player={}
	player.x=24
	player.y=24
  player.jump=2.5
  player.ax=0
  player.ay=0
  player.acc=0.3
  player.frict=0.2
  player.mx_spd=4
  player.facing=0
  player.grounded=1
  player.w = 0.4
  player.h = 0.4
  player.collide_map = true;

  game={}
  game.gravity=0.1
end

function hit(x,y,w,h)
  collide=false
  for i=x,x+w,w do
    if (fget(mget(i/8,y/8))>0) or
         (fget(mget(i/8,(y+h)/8))>0) then
          collide=true
    end
  end

  for i=y,y+h,h do
    if (fget(mget(x/8,i/8))>0) or
         (fget(mget((x+w)/8,i/8))>0) then
          collide=true
    end
  end
  return collide
end

function animate(object,starting_frame,number_of_frames,speed,ticks)
	if(not object.a_ct) object.a_ct=0
	if(not object.a_st)	object.a_st=0

	object.a_ct+=1

	if(object.a_ct%(30/speed)==0) then
	 object.a_st+=1
	 if(object.a_st==number_of_frames) object.a_st=0
	end

	object.a_fr=starting_frame+object.a_st
	spr(object.a_fr,object.x,object.y,1,1,ticks)
end

function _update()
  local last_x = player.x
  local last_y = player.y

	cls()
  map()
  print("spr"..player.ax ,2,2,3)
	if(btn(0)) and (player.ax < player.mx_spd and player.ax > -player.mx_spd) then
		player.ax-=player.acc
    player.facing=0
    animate(player,3,2,6,true)
	elseif(btn(1)) and (player.ax < player.mx_spd and player.ax > -player.mx_spd) then
		player.ax+=player.acc
    player.facing=1
    animate(player,3,2,6,false)
	else
    if(player.facing == 1) then
      spr(3,player.x,player.y)
    else
      spr(3,player.x,player.y,1,1,true,false)
    end
  end
  if btn(2) and player.grounded == 1 then
		player.ay -= player.jump
		player.grounded = 0
	end


  if player.ax > 0 then
 		player.ax -= player.frict
     if(player.ax < 0) player.ax=0
 	end
 	if player.ax < 0 then
 		player.ax += player.frict
     if(player.ax > 0) player.ax=0
 	end

  if(grounded) then
    player.ay =0.0
  else
    player.ay += game.gravity
  end

  if hit(player.x+player.ax,player.y,7,7) then
    player.ax =0
  end
  if hit(player.x,player.y+player.ay,7,7) then
    if player.ay > 0 then
      player.grounded = 1;
    end
    player.ay =0
  end

  player.x += player.ax
  player.y += player.ay

	if player.x < 0 then
		player.x = 120
	end
	if player.x > 120 then
		player.x = 0
	end

end

function _draw()

end


__gfx__
00000000009d1d00009d1d0000ce8e0000ce8e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000009d0dddd09d0dddd0ce0eeee0ce0eeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000077dddd0077dddd0077eeee0077eeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000977dddd0977dddd0c77eeee0c77eeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000009677700096777000ce777000c677700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070019116610019116108c88668008c886800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001d16611011d161108e86688088e86880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009904400009940000cc0dd0000ccd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44443344000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44443444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
40440044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010000010100010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010000010100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000000100000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000077500c75012750187501d75020750227501e750167500f7500975004750017500175012750117501175011750137501475013750107500d7500a7500a7500a7500a7500b75000700007000070000700
